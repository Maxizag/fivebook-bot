# Работа с миграциями базы данных

## Основные команды

### Проверка текущего состояния
```bash
alembic current
```

### Просмотр истории миграций
```bash
alembic history
```

### Применить все миграции
```bash
alembic upgrade head
```

### Откатить последнюю миграцию
```bash
alembic downgrade -1
```

### Создать новую миграцию после изменения моделей
```bash
alembic revision --autogenerate -m "описание изменений"
```

## Важные правила

1. **Перед изменением моделей** - создай бэкап БД:
```bash
cp fivebook.db backups/fivebook_backup_$(date +%Y%m%d_%H%M%S).db
```

2. **После изменения models.py** - создай миграцию:
```bash
alembic revision --autogenerate -m "описание"
```

3. **Проверь файл миграции** в `alembic/versions/` - убери лишнее, если есть

4. **Примени миграцию**:
```bash
alembic upgrade head
```

5. **Проверь работу бота** после применения миграции

## Перенос на новый сервер

1. Скопируй файл `fivebook.db`
2. Скопируй код проекта
3. Установи зависимости: `pip install -r requirements.txt`
4. Создай `.env` с токеном
5. Проверь миграции: `alembic current`
6. Запусти бота: `python3 bot.py`

## Структура файлов
```
Fivebook/
├── fivebook.db          # База данных (НЕ удалять!)
├── backups/             # Резервные копии БД
├── alembic/             # Папка с миграциями
│   └── versions/        # Файлы миграций
└── alembic.ini          # Конфигурация Alembic
```

## Troubleshooting

Если миграция не применяется:
1. Проверь что БД не используется (останови бота)
2. Сделай бэкап
3. Проверь файл миграции на ошибки
4. Попробуй применить снова